<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Harga Jual Ideal UMKM Marketplace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .calculator-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #495057;
            border-bottom: 3px solid #007bff;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .form-group input:valid {
            border-color: #28a745;
        }

        .form-group input:invalid {
            border-color: #dc3545;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-success {
            background-color: #28a745;
        }

        .status-warning {
            background-color: #ffc107;
        }

        .status-danger {
            background-color: #dc3545;
        }

        .calculation-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .calculation-summary h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .calculation-summary .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 0 20px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .step::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e9ecef;
            z-index: 1;
        }

        .step:last-child::after {
            display: none;
        }

        .step.active::after {
            background-color: #007bff;
        }

        .step-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }

        .step.active .step-circle {
            background-color: #007bff;
            color: white;
            border: 2px solid #ffffff;
            box-shadow: 0 0 15px rgba(0,123,255,0.5);
        }

        .step.completed .step-circle {
            background-color: #28a745;
            color: white;
            border: 2px solid #ffffff;
            box-shadow: 0 0 10px rgba(40,167,69,0.3);
        }

        .step-label {
            margin-top: 8px;
            font-size: 0.9rem;
            text-align: center;
            color: #ffffff;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .step.active .step-label {
            color: #ffffff;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .step.completed .step-label {
            color: #ffffff;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .step.locked .step-label {
            color: #ffffff;
            opacity: 0.7;
            font-weight: 400;
        }

        .step.locked {
            opacity: 0.6;
            pointer-events: none;
        }

        .step.locked .step-circle {
            background-color: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.5);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .step.locked .step-label {
            color: rgba(255,255,255,0.5);
            opacity: 0.7;
        }

        .phase-status {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .phase-status.completed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .phase-status.in-progress {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .phase-status.pending {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .phase-status-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .help-text {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        .input-group {
            position: relative;
        }

        .input-group .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-weight: bold;
        }

        .input-group input {
            padding-left: 35px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.info {
            background: #17a2b8;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .notification .close {
            float: right;
            margin-left: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            max-width: 250px;
            z-index: 1000;
            display: none;
        }

        .keyboard-shortcuts.show {
            display: block;
        }

        .shortcut-key {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            margin: 0 2px;
        }

        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            margin: auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-header .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .modal-header .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .analysis-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .analysis-card h4 {
            color: #007bff;
            margin-bottom: 15px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .metric-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .recommendation {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .recommendation h5 {
            color: #155724;
            margin-bottom: 10px;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .warning h5 {
            color: #856404;
            margin-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .btn {
            background: #007bff;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border-left: 5px solid #007bff;
        }

        .results h3 {
            color: #007bff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .result-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: #28a745;
        }

        .result-label {
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .section-title {
            font-size: 1.3rem;
            color: #495057;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .marketplace-rates {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .marketplace-rates h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        /* Dashboard Analytics Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .chart-container {
            height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .chart-bar {
            background: linear-gradient(135deg, #007bff, #0056b3);
            margin: 0 2px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .chart-bar:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: scaleY(1.05);
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #666;
            white-space: nowrap;
        }

        .chart-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: bold;
            color: #007bff;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Template Manager Styles */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .template-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .template-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: #28a745;
            background: #f8fff9;
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .template-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .template-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .template-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .template-tag {
            background: #e9ecef;
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .template-actions {
            display: flex;
            gap: 10px;
        }

        .btn-template {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-apply {
            background: #28a745;
            color: white;
        }

        .btn-apply:hover {
            background: #218838;
        }

        .btn-preview {
            background: #17a2b8;
            color: white;
        }

        .btn-preview:hover {
            background: #138496;
        }

        .template-preview {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        .preview-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #495057;
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        .preview-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #007bff;
        }

        /* Action Groups & Button Layout */
        .action-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }

        .action-group h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .button-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Enhanced Button Styles */
        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            min-height: 48px;
            justify-content: center;
        }

        .btn-large {
            padding: 16px 24px;
            font-size: 16px;
            min-height: 56px;
            flex: 1;
            max-width: 300px;
        }

        .btn-icon {
            font-size: 18px;
            line-height: 1;
        }

        .btn-text {
            line-height: 1.2;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Button Color Variants */
        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #545b62, #3d4043);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #1e7e34, #155724);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #138496, #0c5460);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e0a800, #d39e00);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
        }

        .btn-dark {
            background: linear-gradient(135deg, #343a40, #23272b);
            color: white;
        }

        .btn-dark:hover {
            background: linear-gradient(135deg, #23272b, #1d2124);
        }

        .btn-purple {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
        }

        .btn-purple:hover {
            background: linear-gradient(135deg, #5a32a3, #4c2a85);
        }

        /* Responsive Design for Buttons */
        @media (max-width: 768px) {
            .button-row {
                flex-direction: column;
            }

            .button-grid {
                grid-template-columns: 1fr;
            }

            .btn-large {
                max-width: none;
            }

            .action-group {
                padding: 15px;
                margin: 15px 0;
            }
        }

        /* Enhanced Visual Improvements */
        .tab-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: block;
        }

        .input-group {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-weight: 500;
            z-index: 2;
        }

        .input-group input {
            padding-left: 35px;
        }

        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }

        @media (max-width: 768px) {
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .dashboard-grid, .template-grid {
                grid-template-columns: 1fr;
            }

            .button-row {
                flex-direction: column;
            }

            .button-grid {
                grid-template-columns: 1fr;
            }

            .btn-large {
                max-width: none;
            }

            .action-group {
                padding: 15px;
                margin: 15px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Kalkulator Harga Jual Ideal UMKM</h1>
            <p>Tools Akuntansi Biaya Komprehensif untuk Marketplace Digital</p>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            
            <div class="step-indicator">
                <div class="step active" id="step-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">HPP & COGS</div>
                </div>
                <div class="step" id="step-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Operasional</div>
                </div>
                <div class="step" id="step-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Marketplace</div>
                </div>
                <div class="step" id="step-4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Pajak</div>
                </div>
                <div class="step" id="step-5">
                    <div class="step-circle">5</div>
                    <div class="step-label">Hasil</div>
                </div>
            </div>
        </div>

        <div class="calculator-container">
            <div class="tabs">
                <button class="tab active" onclick="showTab('modul1')">Modul 1: HPP & COGS</button>
                <button class="tab" onclick="showTab('modul2')">Modul 2: Operasional</button>
                <button class="tab" onclick="showTab('modul3')">Modul 3: Marketplace</button>
                <button class="tab" onclick="showTab('modul4')">Modul 4: Pajak</button>
                <button class="tab" onclick="showTab('modul5')">Modul 5: Hasil</button>
            </div>

            <!-- Modul 1: HPP dan COGS Inti -->
            <div id="modul1" class="tab-content active">
                <h2 class="section-title">Modul 1: Harga Pokok Penjualan (HPP) dan COGS Inti</h2>
                
                <div class="alert alert-info">
                    <strong>üí° Cara Kerja:</strong> Isi biaya bahan baku, tenaga kerja, dan overhead pabrik untuk menghitung total biaya produksi per unit produk. Hasilnya akan digunakan untuk menentukan harga jual yang tepat.
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bbl">
                            Biaya Bahan Baku Langsung (BBL) per Unit (Rp)
                            <span class="tooltip">?
                                <span class="tooltiptext">Biaya bahan baku utama dan penolong yang dapat diatribusikan langsung per unit produk</span>
                            </span>
                        </label>
                        <div class="input-group">
                            <span class="currency-symbol">Rp</span>
                            <input type="number" id="bbl" placeholder="0" min="0" step="100">
                        </div>
                        <div class="help-text">Contoh: Bahan baku utama, kemasan primer, bahan penolong yang langsung digunakan untuk membuat produk</div>
                    </div>
                    <div class="form-group">
                        <label for="btkl">
                            Biaya Tenaga Kerja Langsung (BTKL) per Unit (Rp)
                            <span class="tooltip">?
                                <span class="tooltiptext">Gaji dan upah tenaga kerja yang terlibat langsung dalam proses produksi</span>
                            </span>
                        </label>
                        <div class="input-group">
                            <span class="currency-symbol">Rp</span>
                            <input type="number" id="btkl" placeholder="0" min="0" step="100">
                        </div>
                        <div class="help-text">Cara hitung: Total gaji karyawan produksi per bulan √∑ jumlah produk yang dibuat per bulan</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bop">
                        Biaya Overhead Pabrik (BOP) per Unit (Rp)
                        <span class="tooltip">?
                            <span class="tooltiptext">Biaya produksi tidak langsung yang harus dialokasikan per unit produk</span>
                        </span>
                    </label>
                    <div class="input-group">
                        <span class="currency-symbol">Rp</span>
                        <input type="number" id="bop" placeholder="0" min="0" step="100">
                    </div>
                    <div class="help-text">Termasuk: listrik/air untuk produksi, penyusutan mesin, biaya kemasan primer</div>
                </div>

                <div class="form-group">
                    <label for="hpp">HPP Inti per Unit (Rp) - Otomatis</label>
                    <input type="number" id="hpp" readonly style="background: #f8f9fa;">
                </div>

                <button class="btn" onclick="calculateHPP()">Hitung HPP</button>
                
                <div id="hpp-summary" class="calculation-summary" style="display: none;">
                    <h4>HPP Inti per Unit</h4>
                    <div class="value" id="hpp-summary-value">Rp 0</div>
                    <small>Biaya produksi langsung per unit produk</small>
                </div>
            </div>

            <!-- Modul 2: Biaya Operasional Non-Produksi -->
            <div id="modul2" class="tab-content">
                <h2 class="section-title">Modul 2: Biaya Operasional Non-Produksi dan Administrasi</h2>
                
                <div class="alert alert-info">
                    <strong>üí° Cara Kerja:</strong> Tambahkan biaya administrasi dan pemasaran yang tidak langsung terkait produksi. Ini akan memberikan gambaran biaya total yang lebih akurat per unit produk.
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="biaya_admin">Total Biaya Administrasi Bulanan (Rp)</label>
                        <input type="number" id="biaya_admin" placeholder="0" min="0" step="1000">
                        <div class="help-text">Contoh: Gaji admin, sewa kantor, internet, software = Rp 5.000.000/bulan</div>
                    </div>
                    <div class="form-group">
                        <label for="target_penjualan">Target Penjualan Bulanan (Unit)</label>
                        <input type="number" id="target_penjualan" placeholder="0" min="1" step="1">
                        <div class="help-text">Contoh: Target menjual 100 unit produk per bulan</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="biaya_pemasaran">Biaya Pemasaran Non-Marketplace per Unit (Rp)</label>
                        <input type="number" id="biaya_pemasaran" placeholder="0" min="0" step="100">
                        <div class="help-text">Contoh: Iklan Facebook, Google Ads = Rp 2.000/unit</div>
                    </div>
                    <div class="form-group">
                        <label for="biaya_pengemasan">Biaya Pengemasan Sekunder per Unit (Rp)</label>
                        <input type="number" id="biaya_pengemasan" placeholder="0" min="0" step="100">
                        <div class="help-text">Contoh: Label, bubble wrap, kardus = Rp 1.500/unit</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cogs_total">COGS Total per Unit (Rp) - Otomatis</label>
                    <input type="number" id="cogs_total" readonly style="background: #f8f9fa;">
                </div>

                <button class="btn" onclick="calculateCOGS()">Hitung COGS Total</button>
                
                <div id="cogs-summary" class="calculation-summary" style="display: none;">
                    <h4>COGS Total per Unit</h4>
                    <div class="value" id="cogs-summary-value">Rp 0</div>
                    <small>Total biaya per unit termasuk operasional</small>
                </div>
            </div>

            <!-- Modul 3: Biaya Platform Marketplace -->
            <div id="modul3" class="tab-content">
                <h2 class="section-title">Modul 3: Biaya Platform Marketplace (Dinamis)</h2>
                
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Penting:</strong> Pilih marketplace dan kategori produk Anda. Biaya platform akan otomatis dihitung berdasarkan pilihan ini. Semakin tinggi harga jual, semakin besar biaya platform yang harus dibayar.
                    <br><br>
                    <strong>üì± TikTok Shop:</strong> Platform terbaru dengan tarif kompetitif (2-6%) dan fokus pada konten video. Cocok untuk produk lifestyle dan beauty.
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="marketplace">Pilih Marketplace</label>
                        <select id="marketplace" onchange="updateMarketplaceRates()">
                            <option value="">Pilih Platform</option>
                            <option value="shopee">Shopee</option>
                            <option value="tokopedia">Tokopedia</option>
                            <option value="lazada">Lazada</option>
                            <option value="tiktok">TikTok Shop</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="status_penjual">Status Penjual</label>
                        <select id="status_penjual">
                            <option value="reguler">Reguler</option>
                            <option value="power">Power Merchant</option>
                            <option value="star">Star</option>
                            <option value="mall">Mall</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="kategori_produk">Kategori Produk</label>
                        <select id="kategori_produk" onchange="updateAdminRate()">
                            <option value="">Pilih Kategori</option>
                            <option value="elektronik">Elektronik (8.5%)</option>
                            <option value="fashion">Fashion (5.0%)</option>
                            <option value="makanan">Makanan & Minuman (3.0%)</option>
                            <option value="kesehatan">Kesehatan & Kecantikan (4.5%)</option>
                            <option value="rumah">Rumah & Taman (3.5%)</option>
                            <option value="olahraga">Olahraga (4.0%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="biaya_admin_rate">Biaya Admin Dasar (%)</label>
                        <input type="number" id="biaya_admin_rate" placeholder="0" min="0" max="15" step="0.1" readonly style="background: #f8f9fa;">
                    </div>
                </div>

                <div class="marketplace-rates">
                    <h4>Program Promosi XTRA</h4>
                    <div class="checkbox-group">
                        <input type="checkbox" id="gratis_ongkir" onchange="updateXTRARates()">
                        <label for="gratis_ongkir">Gratis Ongkir XTRA (Max 4.0%)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="cashback_xtra" onchange="updateXTRARates()">
                        <label for="cashback_xtra">Cashback XTRA (Max 1.4%)</label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="komisi_afiliasi">Estimasi Komisi Afiliasi (%)</label>
                        <input type="number" id="komisi_afiliasi" placeholder="0" min="0" max="10" step="0.1">
                        <div class="help-text">Contoh: 5% untuk pembeli setia, 10% untuk pembeli baru</div>
                    </div>
                    <div class="form-group">
                        <label for="persentase_afiliasi">Persentase Transaksi Afiliasi (%)</label>
                        <input type="number" id="persentase_afiliasi" placeholder="0" min="0" max="100" step="1">
                        <div class="help-text">Contoh: 30% dari total penjualan berasal dari link afiliasi</div>
                    </div>
                </div>

                <button class="btn" onclick="calculateMarketplaceCosts()">Hitung Biaya Marketplace</button>
            </div>

            <!-- Modul 4: Pajak dan Kepatuhan -->
            <div id="modul4" class="tab-content">
                <h2 class="section-title">Modul 4: Variabel Pajak dan Kepatuhan</h2>
                
                <div class="alert alert-info">
                    <strong>üí° Cara Kerja:</strong> Tentukan status pajak Anda. Jika omzet sudah melebihi Rp500 juta per tahun, Anda wajib membayar PPh Final 0,5%. PPN 11% berlaku jika Anda sudah PKP.
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="omzet_kumulatif">Omzet Kumulatif Tahun Ini (Rp)</label>
                        <input type="number" id="omzet_kumulatif" placeholder="0" min="0" step="1000000">
                        <div class="help-text">Contoh: Total penjualan dari Januari sampai sekarang = Rp 300.000.000</div>
                    </div>
                    <div class="form-group">
                        <label for="pph_final_status">Status PPh Final 0.5%</label>
                        <select id="pph_final_status" onchange="updatePPhStatus()">
                            <option value="tidak">Tidak (Omzet < Rp500 Juta)</option>
                            <option value="ya">Ya (Omzet ‚â• Rp500 Juta)</option>
                        </select>
                        <div class="help-text">Otomatis terisi berdasarkan omzet kumulatif</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="ppn_status">Status PPN 11%</label>
                        <select id="ppn_status">
                            <option value="tidak">Tidak (Bukan PKP)</option>
                            <option value="ya">Ya (PKP)</option>
                        </select>
                        <div class="help-text">PKP = Pengusaha Kena Pajak (omzet > Rp4,8 miliar/tahun)</div>
                    </div>
                    <div class="form-group">
                        <label for="ppn_rate">Tarif PPN (%)</label>
                        <input type="number" id="ppn_rate" value="11" min="0" max="15" step="0.1" readonly style="background: #f8f9fa;">
                        <div class="help-text">Tarif PPN standar di Indonesia</div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <strong>üìù Catatan:</strong> PPh Final 0,5% hanya dikenakan jika omzet Anda sudah melebihi Rp500 juta per tahun. Jika belum, Anda tidak perlu membayar PPh Final.
                </div>

                <button class="btn" onclick="calculateTaxCosts()">Hitung Biaya Pajak</button>
            </div>

            <!-- Modul 5: Hasil dan Strategi Harga -->
            <div id="modul5" class="tab-content">
                <h2 class="section-title">Modul 5: Strategi Penentuan Harga Jual Ideal</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="target_npm">Target Net Profit Margin (%)</label>
                        <input type="number" id="target_npm" placeholder="15" min="0" max="50" step="0.1">
                        <div class="help-text">Contoh: 15% = keuntungan bersih 15% dari harga jual</div>
                    </div>
                    <div class="form-group">
                        <label for="diskon_terencana">Diskon/Markdown Terencana (%)</label>
                        <input type="number" id="diskon_terencana" placeholder="0" min="0" max="50" step="0.1">
                        <div class="help-text">Contoh: 10% = diskon 10% untuk promosi atau loyalitas</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="harga_kompetitor">Harga Jual Kompetitor (Rp) - Opsional</label>
                    <input type="number" id="harga_kompetitor" placeholder="0" min="0" step="1000">
                    <div class="help-text">Contoh: Harga produk serupa di marketplace = Rp 50.000</div>
                </div>

                <!-- Primary Actions -->
                <div class="action-group">
                    <h4>üéØ Aksi Utama</h4>
                    <div class="button-row">
                        <button class="btn btn-primary btn-large" onclick="calculateFinalPrice()">
                            <span class="btn-icon">üí∞</span>
                            <span class="btn-text">Hitung Harga Jual Ideal</span>
                        </button>
                        <button class="btn btn-secondary btn-large" onclick="simulateScenarios()">
                            <span class="btn-icon">üìä</span>
                            <span class="btn-text">Simulasi Skenario</span>
                        </button>
                    </div>
                </div>

                <!-- Analysis Tools -->
                <div class="action-group">
                    <h4>üìà Analisis & Insights</h4>
                    <div class="button-grid">
                        <button class="btn btn-info" onclick="showBreakEvenAnalysis()">
                            <span class="btn-icon">üìà</span>
                            <span class="btn-text">Break-Even Analysis</span>
                        </button>
                        <button class="btn btn-purple" onclick="showCompetitorAnalysis()">
                            <span class="btn-icon">üèÜ</span>
                            <span class="btn-text">Analisis Kompetitor</span>
                        </button>
                        <button class="btn btn-success" onclick="showDashboardAnalytics()">
                            <span class="btn-icon">üìä</span>
                            <span class="btn-text">Dashboard Analytics</span>
                        </button>
                    </div>
                </div>

                <!-- Tools & Utilities -->
                <div class="action-group">
                    <h4>üõ†Ô∏è Tools & Utilities</h4>
                    <div class="button-row">
                        <button class="btn btn-warning" onclick="showTemplateManager()">
                            <span class="btn-icon">üìã</span>
                            <span class="btn-text">Template Manager</span>
                        </button>
                        <button class="btn btn-dark" onclick="exportResults()">
                            <span class="btn-icon">üì§</span>
                            <span class="btn-text">Export Hasil</span>
                        </button>
                        <button class="btn btn-danger" onclick="resetAllData()">
                            <span class="btn-icon">üîÑ</span>
                            <span class="btn-text">Reset Data</span>
                        </button>
                    </div>
                </div>

                <div id="results" class="results" style="display: none;">
                    <h3>Hasil Perhitungan Harga Jual Ideal</h3>
                    <div id="results-content"></div>
                </div>

                <div id="scenario-results" class="results" style="display: none;">
                    <h3>Simulasi Skenario</h3>
                    <div id="scenario-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div id="keyboard-shortcuts" class="keyboard-shortcuts">
        <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
        <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">1-5</span> = Pindah ke Modul</div>
        <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">R</span> = Reset Data</div>
        <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">E</span> = Export Hasil</div>
        <div><span class="shortcut-key">F1</span> = Toggle Help</div>
        <div><span class="shortcut-key">Esc</span> = Tutup Help</div>
    </div>

    <!-- Break-Even Analysis Modal -->
    <div id="break-even-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìà Analisis Break-Even Point</h3>
                <span class="close" onclick="closeModal('break-even-modal')">&times;</span>
            </div>
            <div class="modal-body" id="break-even-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Competitor Analysis Modal -->
    <div id="competitor-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üèÜ Analisis Kompetitor & Rekomendasi</h3>
                <span class="close" onclick="closeModal('competitor-modal')">&times;</span>
            </div>
            <div class="modal-body" id="competitor-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Dashboard Analytics Modal -->
    <div id="dashboard-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h3>üìä Dashboard Analytics & Visualisasi Data</h3>
                <span class="close" onclick="closeModal('dashboard-modal')">&times;</span>
            </div>
            <div class="modal-body" id="dashboard-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Template Manager Modal -->
    <div id="template-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3>üìã Template Manager & Preset Biaya</h3>
                <span class="close" onclick="closeModal('template-modal')">&times;</span>
            </div>
            <div class="modal-body" id="template-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global variables untuk menyimpan hasil perhitungan
        let hpp = 0;
        let cogsTotal = 0;
        let biayaAdminRate = 0;
        let biayaXTRA = 0;
        let komisiAfiliasiRate = 0;
        let pphFinalRate = 0;
        let ppnRate = 0;

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'success', duration = 3000) {
            // Hapus notifikasi yang ada
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Buat notifikasi baru
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span class="close" onclick="this.parentElement.remove()">&times;</span>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // Tampilkan notifikasi
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-hide setelah duration
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        // Fungsi untuk menampilkan tombol lanjut ke fase berikutnya
        function showNextPhaseButton(nextTab, buttonText) {
            // Hapus tombol yang ada
            const existingButton = document.querySelector('.next-phase-btn');
            if (existingButton) {
                existingButton.remove();
            }

            // Buat tombol baru
            const nextButton = document.createElement('button');
            nextButton.className = 'btn btn-success next-phase-btn';
            nextButton.textContent = buttonText;
            nextButton.style.marginTop = '20px';
            nextButton.style.width = '100%';
            nextButton.onclick = function() {
                showTab(nextTab);
                // Update tab button
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector(`[onclick="showTab('${nextTab}')"]`).classList.add('active');
                // Hapus tombol setelah digunakan
                nextButton.remove();
            };

            // Tambahkan tombol ke tab content yang aktif
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.appendChild(nextButton);
        }

        // Fungsi untuk validasi data fase 1 (HPP)
        function validatePhase1() {
            const bbl = parseFloat(document.getElementById('bbl').value) || 0;
            const btkl = parseFloat(document.getElementById('btkl').value) || 0;
            const bop = parseFloat(document.getElementById('bop').value) || 0;
            
            if (bbl === 0 && btkl === 0 && bop === 0) {
                showNotification('Mohon isi minimal satu komponen biaya (BBL, BTKL, atau BOP)', 'warning');
                return false;
            }
            return true;
        }

        // Fungsi untuk validasi data fase 2 (COGS)
        function validatePhase2() {
            const biayaAdmin = parseFloat(document.getElementById('biaya_admin').value) || 0;
            const targetPenjualan = parseFloat(document.getElementById('target_penjualan').value) || 0;
            
            if (targetPenjualan === 0) {
                showNotification('Target penjualan bulanan harus diisi', 'warning');
                return false;
            }
            return true;
        }

        // Fungsi untuk validasi data fase 3 (Marketplace)
        function validatePhase3() {
            const marketplace = document.getElementById('marketplace').value;
            const kategori = document.getElementById('kategori_produk').value;
            
            if (!marketplace) {
                showNotification('Pilih marketplace terlebih dahulu', 'warning');
                return false;
            }
            if (!kategori) {
                showNotification('Pilih kategori produk terlebih dahulu', 'warning');
                return false;
            }
            return true;
        }

        // Fungsi untuk menampilkan tab
        function showTab(tabName) {
            // Validasi sebelum pindah tab
            if (!canNavigateToTab(tabName)) {
                return;
            }

            // Sembunyikan semua tab content
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Hapus active class dari semua tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Tampilkan tab yang dipilih
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Update progress indicator
            updateProgressIndicator(tabName);
        }

        // Fungsi untuk validasi navigasi antar tab
        function canNavigateToTab(targetTab) {
            const currentTab = document.querySelector('.tab-content.active').id;
            
            // Jika pindah ke tab yang sama, tidak perlu validasi
            if (currentTab === targetTab) {
                return true;
            }
            
            // Validasi berdasarkan tab yang dituju
            switch(targetTab) {
                case 'modul2':
                    if (hpp <= 0) {
                        showNotification('Selesaikan perhitungan HPP terlebih dahulu', 'warning');
                        return false;
                    }
                    break;
                case 'modul3':
                    if (hpp <= 0 || cogsTotal <= 0) {
                        showNotification('Selesaikan perhitungan HPP dan COGS terlebih dahulu', 'warning');
                        return false;
                    }
                    break;
                case 'modul4':
                    if (hpp <= 0 || cogsTotal <= 0 || biayaAdminRate <= 0) {
                        showNotification('Selesaikan perhitungan HPP, COGS, dan Marketplace terlebih dahulu', 'warning');
                        return false;
                    }
                    break;
                case 'modul5':
                    if (hpp <= 0 || cogsTotal <= 0 || biayaAdminRate <= 0) {
                        showNotification('Selesaikan semua perhitungan sebelumnya terlebih dahulu', 'warning');
                        return false;
                    }
                    break;
            }
            
            return true;
        }

        // Fungsi untuk update progress indicator
        function updateProgressIndicator(tabName) {
            const progressFill = document.getElementById('progress-fill');
            const steps = document.querySelectorAll('.step');
            
            // Reset semua step
            steps.forEach(step => {
                step.classList.remove('active', 'completed', 'locked');
            });
            
            // Update progress berdasarkan tab
            let progress = 0;
            let activeStep = 0;
            
            switch(tabName) {
                case 'modul1':
                    progress = 20;
                    activeStep = 1;
                    // Lock steps 2-5
                    for (let i = 2; i <= 5; i++) {
                        document.getElementById(`step-${i}`).classList.add('locked');
                    }
                    break;
                case 'modul2':
                    progress = 40;
                    activeStep = 2;
                    // Mark step 1 as completed if HPP is calculated
                    if (hpp > 0) {
                        document.getElementById('step-1').classList.add('completed');
                    }
                    // Lock steps 3-5
                    for (let i = 3; i <= 5; i++) {
                        document.getElementById(`step-${i}`).classList.add('locked');
                    }
                    break;
                case 'modul3':
                    progress = 60;
                    activeStep = 3;
                    // Mark previous steps as completed if data is available
                    if (hpp > 0) document.getElementById('step-1').classList.add('completed');
                    if (cogsTotal > 0) document.getElementById('step-2').classList.add('completed');
                    // Lock steps 4-5
                    for (let i = 4; i <= 5; i++) {
                        document.getElementById(`step-${i}`).classList.add('locked');
                    }
                    break;
                case 'modul4':
                    progress = 80;
                    activeStep = 4;
                    // Mark previous steps as completed if data is available
                    if (hpp > 0) document.getElementById('step-1').classList.add('completed');
                    if (cogsTotal > 0) document.getElementById('step-2').classList.add('completed');
                    if (biayaAdminRate > 0) document.getElementById('step-3').classList.add('completed');
                    // Lock step 5
                    document.getElementById('step-5').classList.add('locked');
                    break;
                case 'modul5':
                    progress = 100;
                    activeStep = 5;
                    // Mark all previous steps as completed
                    for (let i = 1; i <= 4; i++) {
                        document.getElementById(`step-${i}`).classList.add('completed');
                    }
                    break;
            }
            
            // Update progress bar
            progressFill.style.width = progress + '%';
            
            // Set active step
            if (activeStep > 0) {
                document.getElementById(`step-${activeStep}`).classList.add('active');
            }
        }

        // Fungsi untuk menghitung HPP
        function calculateHPP() {
            // Validasi data terlebih dahulu
            if (!validatePhase1()) {
                return;
            }

            const bbl = parseFloat(document.getElementById('bbl').value) || 0;
            const btkl = parseFloat(document.getElementById('btkl').value) || 0;
            const bop = parseFloat(document.getElementById('bop').value) || 0;
            
            hpp = bbl + btkl + bop;
            document.getElementById('hpp').value = hpp.toLocaleString('id-ID');
            
            // Update visual feedback tanpa pop-up
            updateHPPStatus();
        }

        // Fungsi untuk update status HPP dengan visual feedback
        function updateHPPStatus() {
            const hppField = document.getElementById('hpp');
            const hppSummary = document.getElementById('hpp-summary');
            const hppSummaryValue = document.getElementById('hpp-summary-value');
            
            if (hpp > 0) {
                hppField.style.borderColor = '#28a745';
                hppField.style.backgroundColor = '#d4edda';
                hppSummaryValue.textContent = `Rp ${hpp.toLocaleString('id-ID')}`;
                hppSummary.style.display = 'block';
                
                // Tampilkan notifikasi sukses
                showNotification(`HPP Inti berhasil dihitung: Rp ${hpp.toLocaleString('id-ID')}`, 'success');
                
                // Tampilkan tombol untuk lanjut ke fase berikutnya
                showNextPhaseButton('modul2', 'Lanjut ke Modul 2: Biaya Operasional');
            } else {
                hppField.style.borderColor = '#e9ecef';
                hppField.style.backgroundColor = '#f8f9fa';
                hppSummary.style.display = 'none';
            }
        }

        // Fungsi untuk menghitung COGS Total
        function calculateCOGS() {
            // Validasi data terlebih dahulu
            if (!validatePhase2()) {
                return;
            }

            const biayaAdmin = parseFloat(document.getElementById('biaya_admin').value) || 0;
            const targetPenjualan = parseFloat(document.getElementById('target_penjualan').value) || 1;
            const biayaPemasaran = parseFloat(document.getElementById('biaya_pemasaran').value) || 0;
            const biayaPengemasan = parseFloat(document.getElementById('biaya_pengemasan').value) || 0;
            
            const alokasiAdmin = biayaAdmin / targetPenjualan;
            cogsTotal = hpp + alokasiAdmin + biayaPemasaran + biayaPengemasan;
            
            document.getElementById('cogs_total').value = cogsTotal.toLocaleString('id-ID');
            
            // Update visual feedback tanpa pop-up
            updateCOGSStatus();
        }

        // Fungsi untuk update status COGS dengan visual feedback
        function updateCOGSStatus() {
            const cogsField = document.getElementById('cogs_total');
            const cogsSummary = document.getElementById('cogs-summary');
            const cogsSummaryValue = document.getElementById('cogs-summary-value');
            
            if (cogsTotal > 0) {
                cogsField.style.borderColor = '#28a745';
                cogsField.style.backgroundColor = '#d4edda';
                cogsSummaryValue.textContent = `Rp ${cogsTotal.toLocaleString('id-ID')}`;
                cogsSummary.style.display = 'block';
                
                // Tampilkan notifikasi sukses
                showNotification(`COGS Total berhasil dihitung: Rp ${cogsTotal.toLocaleString('id-ID')}`, 'success');
                
                // Tampilkan tombol untuk lanjut ke fase berikutnya
                showNextPhaseButton('modul3', 'Lanjut ke Modul 3: Biaya Marketplace');
            } else {
                cogsField.style.borderColor = '#e9ecef';
                cogsField.style.backgroundColor = '#f8f9fa';
                cogsSummary.style.display = 'none';
            }
        }

        // Fungsi untuk update tarif marketplace
        function updateMarketplaceRates() {
            const marketplace = document.getElementById('marketplace').value;
            const kategoriSelect = document.getElementById('kategori_produk');
            
            // Reset kategori
            kategoriSelect.innerHTML = '<option value="">Pilih Kategori</option>';
            
            if (marketplace === 'shopee') {
                kategoriSelect.innerHTML += `
                    <option value="elektronik">Elektronik (8.5%)</option>
                    <option value="fashion">Fashion (5.0%)</option>
                    <option value="makanan">Makanan & Minuman (3.0%)</option>
                    <option value="kesehatan">Kesehatan & Kecantikan (4.5%)</option>
                    <option value="rumah">Rumah & Taman (3.5%)</option>
                    <option value="olahraga">Olahraga (4.0%)</option>
                `;
            } else if (marketplace === 'tokopedia') {
                kategoriSelect.innerHTML += `
                    <option value="elektronik">Elektronik (8.5%)</option>
                    <option value="fashion">Fashion (6.0%)</option>
                    <option value="makanan">Makanan & Minuman (2.5%)</option>
                    <option value="kesehatan">Kesehatan & Kecantikan (5.0%)</option>
                    <option value="rumah">Rumah & Taman (4.0%)</option>
                    <option value="olahraga">Olahraga (3.5%)</option>
                `;
            } else if (marketplace === 'lazada') {
                kategoriSelect.innerHTML += `
                    <option value="elektronik">Elektronik (10.32%)</option>
                    <option value="fashion">Fashion (6.0%)</option>
                    <option value="makanan">Makanan & Minuman (4.25%)</option>
                    <option value="kesehatan">Kesehatan & Kecantikan (7.0%)</option>
                    <option value="rumah">Rumah & Taman (5.0%)</option>
                    <option value="olahraga">Olahraga (6.5%)</option>
                `;
            } else if (marketplace === 'tiktok') {
                kategoriSelect.innerHTML += `
                    <option value="elektronik">Elektronik (6.0%)</option>
                    <option value="fashion">Fashion (4.0%)</option>
                    <option value="makanan">Makanan & Minuman (2.0%)</option>
                    <option value="kesehatan">Kesehatan & Kecantikan (3.5%)</option>
                    <option value="rumah">Rumah & Taman (3.0%)</option>
                    <option value="olahraga">Olahraga (3.5%)</option>
                    <option value="beauty">Beauty & Personal Care (4.5%)</option>
                    <option value="home">Home & Living (3.5%)</option>
                `;
            }
        }

        // Fungsi untuk update biaya admin berdasarkan kategori
        function updateAdminRate() {
            const kategori = document.getElementById('kategori_produk').value;
            const marketplace = document.getElementById('marketplace').value;
            
            let rates = {};
            
            if (marketplace === 'shopee') {
                rates = {
                    'elektronik': 8.5,
                    'fashion': 5.0,
                    'makanan': 3.0,
                    'kesehatan': 4.5,
                    'rumah': 3.5,
                    'olahraga': 4.0
                };
            } else if (marketplace === 'tokopedia') {
                rates = {
                    'elektronik': 8.5,
                    'fashion': 6.0,
                    'makanan': 2.5,
                    'kesehatan': 5.0,
                    'rumah': 4.0,
                    'olahraga': 3.5
                };
            } else if (marketplace === 'lazada') {
                rates = {
                    'elektronik': 10.32,
                    'fashion': 6.0,
                    'makanan': 4.25,
                    'kesehatan': 7.0,
                    'rumah': 5.0,
                    'olahraga': 6.5
                };
            } else if (marketplace === 'tiktok') {
                rates = {
                    'elektronik': 6.0,
                    'fashion': 4.0,
                    'makanan': 2.0,
                    'kesehatan': 3.5,
                    'rumah': 3.0,
                    'olahraga': 3.5,
                    'beauty': 4.5,
                    'home': 3.5
                };
            }
            
            if (rates[kategori]) {
                biayaAdminRate = rates[kategori];
                document.getElementById('biaya_admin_rate').value = biayaAdminRate;
            }
        }

        // Fungsi untuk update biaya XTRA
        function updateXTRARates() {
            const gratisOngkir = document.getElementById('gratis_ongkir').checked;
            const cashbackXtra = document.getElementById('cashback_xtra').checked;
            
            biayaXTRA = 0;
            if (gratisOngkir) biayaXTRA += 4.0;
            if (cashbackXtra) biayaXTRA += 1.4;
        }

        // Fungsi untuk menghitung biaya marketplace
        function calculateMarketplaceCosts() {
            // Validasi data terlebih dahulu
            if (!validatePhase3()) {
                return;
            }

            updateAdminRate();
            updateXTRARates();
            
            const komisiAfiliasi = parseFloat(document.getElementById('komisi_afiliasi').value) || 0;
            const persentaseAfiliasi = parseFloat(document.getElementById('persentase_afiliasi').value) || 0;
            
            komisiAfiliasiRate = (komisiAfiliasi * persentaseAfiliasi) / 100;
            
            // Update visual feedback tanpa pop-up
            updateMarketplaceStatus();
            
            // Tampilkan tombol untuk lanjut ke fase berikutnya
            showNextPhaseButton('modul4', 'Lanjut ke Modul 4: Pajak & Kepatuhan');
        }

        // Fungsi untuk update status marketplace dengan visual feedback
        function updateMarketplaceStatus() {
            const adminField = document.getElementById('biaya_admin_rate');
            if (biayaAdminRate > 0) {
                adminField.style.borderColor = '#17a2b8';
                adminField.style.backgroundColor = '#d1ecf1';
                
                // Tampilkan notifikasi info
                showNotification(`Biaya marketplace dikonfigurasi: Admin ${biayaAdminRate}%, XTRA ${biayaXTRA}%`, 'info');
            } else {
                adminField.style.borderColor = '#e9ecef';
                adminField.style.backgroundColor = '#f8f9fa';
            }
        }

        // Fungsi untuk update status PPh
        function updatePPhStatus() {
            const omzetKumulatif = parseFloat(document.getElementById('omzet_kumulatif').value) || 0;
            const pphStatus = document.getElementById('pph_final_status');
            
            if (omzetKumulatif >= 500000000) {
                pphStatus.value = 'ya';
                pphFinalRate = 0.5;
            } else {
                pphStatus.value = 'tidak';
                pphFinalRate = 0;
            }
        }

        // Fungsi untuk menghitung biaya pajak
        function calculateTaxCosts() {
            updatePPhStatus();
            
            const ppnStatus = document.getElementById('ppn_status').value;
            ppnRate = ppnStatus === 'ya' ? 11 : 0;
            
            // Update visual feedback tanpa pop-up
            updateTaxStatus();
            
            // Tampilkan tombol untuk lanjut ke fase berikutnya
            showNextPhaseButton('modul5', 'Lanjut ke Modul 5: Hasil & Strategi Harga');
        }

        // Fungsi untuk update status pajak dengan visual feedback
        function updateTaxStatus() {
            const pphField = document.getElementById('pph_final_status');
            const ppnField = document.getElementById('ppn_status');
            
            // Reset warna ke default
            pphField.style.borderColor = '#e9ecef';
            pphField.style.backgroundColor = '#f8f9fa';
            ppnField.style.borderColor = '#e9ecef';
            ppnField.style.backgroundColor = '#f8f9fa';
            
            // Hanya beri warna khusus jika ada kewajiban pajak
            if (pphFinalRate > 0) {
                pphField.style.borderColor = '#17a2b8';
                pphField.style.backgroundColor = '#d1ecf1';
            }
            
            if (ppnRate > 0) {
                ppnField.style.borderColor = '#17a2b8';
                ppnField.style.backgroundColor = '#d1ecf1';
            }
            
            // Tampilkan notifikasi info
            let taxMessage = 'Status pajak: ';
            if (pphFinalRate > 0) taxMessage += `PPh Final ${pphFinalRate}% `;
            if (ppnRate > 0) taxMessage += `PPN ${ppnRate}%`;
            if (pphFinalRate === 0 && ppnRate === 0) taxMessage += 'Tidak ada kewajiban pajak';
            
            showNotification(taxMessage, 'info');
        }

        // Fungsi untuk menghitung harga jual ideal
        function calculateFinalPrice() {
            const targetNPM = parseFloat(document.getElementById('target_npm').value) || 15;
            const diskonTerencana = parseFloat(document.getElementById('diskon_terencana').value) || 0;
            
            // Hitung total persentase biaya
            const totalBiayaPersentase = biayaAdminRate + biayaXTRA + komisiAfiliasiRate + pphFinalRate + targetNPM;
            
            // Hitung harga jual kotor ideal
            const hargaJualKotor = cogsTotal / (1 - (totalBiayaPersentase / 100));
            
            // Hitung biaya XTRA aktual (dengan ceiling Rp10.000)
            const biayaXTRAAktual = Math.min(hargaJualKotor * (biayaXTRA / 100), 10000);
            
            // Hitung harga jual setelah diskon
            const hargaJualSetelahDiskon = hargaJualKotor * (1 - diskonTerencana / 100);
            
            // Hitung net profit per unit
            const netProfitPerUnit = hargaJualKotor - cogsTotal - (hargaJualKotor * (biayaAdminRate + komisiAfiliasiRate + pphFinalRate) / 100) - biayaXTRAAktual;
            
            // Hitung margin aktual
            const marginAktual = (netProfitPerUnit / hargaJualKotor) * 100;
            
            // Tampilkan hasil
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            
            resultsContent.innerHTML = `
                <div class="result-item">
                    <span class="result-label">COGS Total per Unit:</span>
                    <span class="result-value">Rp ${cogsTotal.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Harga Jual Kotor Ideal:</span>
                    <span class="result-value">Rp ${hargaJualKotor.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Harga Jual Setelah Diskon:</span>
                    <span class="result-value">Rp ${hargaJualSetelahDiskon.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Biaya Admin (${biayaAdminRate}%):</span>
                    <span class="result-value">Rp ${(hargaJualKotor * biayaAdminRate / 100).toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Biaya XTRA Aktual:</span>
                    <span class="result-value">Rp ${biayaXTRAAktual.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Komisi Afiliasi (${komisiAfiliasiRate.toFixed(2)}%):</span>
                    <span class="result-value">Rp ${(hargaJualKotor * komisiAfiliasiRate / 100).toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">PPh Final (${pphFinalRate}%):</span>
                    <span class="result-value">Rp ${(hargaJualKotor * pphFinalRate / 100).toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Net Profit per Unit:</span>
                    <span class="result-value">Rp ${netProfitPerUnit.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Net Profit Margin Aktual:</span>
                    <span class="result-value">${marginAktual.toFixed(2)}%</span>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
            
            // Tampilkan notifikasi sukses
            showNotification(`Harga jual ideal berhasil dihitung: Rp ${hargaJualKotor.toLocaleString('id-ID')}`, 'success', 5000);
            
            // Cek apakah harga kompetitor ada
            const hargaKompetitor = parseFloat(document.getElementById('harga_kompetitor').value) || 0;
            if (hargaKompetitor > 0) {
                const selisih = hargaJualKotor - hargaKompetitor;
                const persentaseSelisih = (selisih / hargaKompetitor) * 100;
                
                let alertClass = 'alert-info';
                let alertMessage = '';
                
                if (selisih > 0) {
                    alertClass = 'alert-warning';
                    alertMessage = `Harga ideal Rp ${selisih.toLocaleString('id-ID')} (${persentaseSelisih.toFixed(1)}%) lebih tinggi dari kompetitor. Pertimbangkan efisiensi biaya.`;
                } else {
                    alertClass = 'alert-info';
                    alertMessage = `Harga ideal Rp ${Math.abs(selisih).toLocaleString('id-ID')} (${Math.abs(persentaseSelisih).toFixed(1)}%) lebih rendah dari kompetitor. Margin kompetitif baik.`;
                }
                
                resultsContent.innerHTML += `<div class="alert ${alertClass}">${alertMessage}</div>`;
            }
        }

        // Fungsi untuk simulasi skenario
        function simulateScenarios() {
            const targetNPM = parseFloat(document.getElementById('target_npm').value) || 15;
            
            // Skenario Mandiri (Direct Sales)
            const hargaMandiri = cogsTotal / (1 - (targetNPM / 100));
            const profitMandiri = hargaMandiri - cogsTotal;
            const marginMandiri = (profitMandiri / hargaMandiri) * 100;
            
            // Skenario Marketplace
            const totalBiayaPersentase = biayaAdminRate + biayaXTRA + komisiAfiliasiRate + pphFinalRate + targetNPM;
            const hargaMarketplace = cogsTotal / (1 - (totalBiayaPersentase / 100));
            const biayaXTRAAktual = Math.min(hargaMarketplace * (biayaXTRA / 100), 10000);
            const profitMarketplace = hargaMarketplace - cogsTotal - (hargaMarketplace * (biayaAdminRate + komisiAfiliasiRate + pphFinalRate) / 100) - biayaXTRAAktual;
            const marginMarketplace = (profitMarketplace / hargaMarketplace) * 100;
            
            // Selisih biaya
            const selisihHarga = hargaMarketplace - hargaMandiri;
            const selisihMargin = marginMandiri - marginMarketplace;
            
            const scenarioDiv = document.getElementById('scenario-results');
            const scenarioContent = document.getElementById('scenario-content');
            
            scenarioContent.innerHTML = `
                <div class="result-item">
                    <span class="result-label">Harga Jual Mandiri:</span>
                    <span class="result-value">Rp ${hargaMandiri.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Margin Mandiri:</span>
                    <span class="result-value">${marginMandiri.toFixed(2)}%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Harga Jual Marketplace:</span>
                    <span class="result-value">Rp ${hargaMarketplace.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Margin Marketplace:</span>
                    <span class="result-value">${marginMarketplace.toFixed(2)}%</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Selisih Harga:</span>
                    <span class="result-value">Rp ${selisihHarga.toLocaleString('id-ID')}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Selisih Margin:</span>
                    <span class="result-value">${selisihMargin.toFixed(2)}%</span>
                </div>
            `;
            
            scenarioDiv.style.display = 'block';
            
            // Tampilkan notifikasi info
            showNotification(`Simulasi skenario selesai. Selisih margin: ${selisihMargin.toFixed(2)}%`, 'info', 4000);
        }

        // Fungsi untuk reset semua data
        function resetAllData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                // Reset semua input fields
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.value = '';
                });
                
                // Reset semua select fields
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                });
                
                // Reset semua checkbox
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Reset global variables
                hpp = 0;
                cogsTotal = 0;
                biayaAdminRate = 0;
                biayaXTRA = 0;
                komisiAfiliasiRate = 0;
                pphFinalRate = 0;
                ppnRate = 0;
                
                // Reset visual feedback
                document.querySelectorAll('.calculation-summary').forEach(summary => {
                    summary.style.display = 'none';
                });
                
                // Reset results
                document.getElementById('results').style.display = 'none';
                document.getElementById('scenario-results').style.display = 'none';
                
                // Reset progress
                showTab('modul1');
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector('[onclick="showTab(\'modul1\')"]').classList.add('active');
                
                showNotification('Semua data telah direset', 'info');
            }
        }

        // Fungsi untuk export hasil
        function exportResults() {
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'none') {
                showNotification('Hitung harga jual terlebih dahulu', 'warning');
                return;
            }
            
            const resultsContent = document.getElementById('results-content').innerHTML;
            const exportData = `
KALKULATOR HARGA JUAL IDEAL UMKM MARKETPLACE
==============================================

Tanggal: ${new Date().toLocaleDateString('id-ID')}
Waktu: ${new Date().toLocaleTimeString('id-ID')}

HASIL PERHITUNGAN:
${resultsContent.replace(/<[^>]*>/g, '').replace(/Rp /g, 'Rp ').replace(/%/g, '%')}

==============================================
Generated by Kalkulator Harga Jual Ideal UMKM
            `;
            
            // Download as text file
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `harga-jual-ideal-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Hasil berhasil diexport', 'success');
        }

        // Fungsi untuk auto-save data ke localStorage
        function saveDataToLocalStorage() {
            const data = {
                bbl: document.getElementById('bbl').value,
                btkl: document.getElementById('btkl').value,
                bop: document.getElementById('bop').value,
                biaya_admin: document.getElementById('biaya_admin').value,
                target_penjualan: document.getElementById('target_penjualan').value,
                biaya_pemasaran: document.getElementById('biaya_pemasaran').value,
                biaya_pengemasan: document.getElementById('biaya_pengemasan').value,
                marketplace: document.getElementById('marketplace').value,
                kategori_produk: document.getElementById('kategori_produk').value,
                gratis_ongkir: document.getElementById('gratis_ongkir').checked,
                cashback_xtra: document.getElementById('cashback_xtra').checked,
                komisi_afiliasi: document.getElementById('komisi_afiliasi').value,
                persentase_afiliasi: document.getElementById('persentase_afiliasi').value,
                omzet_kumulatif: document.getElementById('omzet_kumulatif').value,
                pph_final_status: document.getElementById('pph_final_status').value,
                ppn_status: document.getElementById('ppn_status').value,
                target_npm: document.getElementById('target_npm').value,
                diskon_terencana: document.getElementById('diskon_terencana').value,
                harga_kompetitor: document.getElementById('harga_kompetitor').value
            };
            
            localStorage.setItem('kalkulatorHargaJual', JSON.stringify(data));
        }

        // Fungsi untuk load data dari localStorage
        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('kalkulatorHargaJual');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Load all form data
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = data[key];
                        } else {
                            element.value = data[key];
                        }
                    }
                });
                
                // Trigger calculations if data exists
                if (data.bbl || data.btkl || data.bop) {
                    calculateHPP();
                }
                if (data.biaya_admin || data.target_penjualan) {
                    calculateCOGS();
                }
                if (data.marketplace && data.kategori_produk) {
                    calculateMarketplaceCosts();
                }
                if (data.omzet_kumulatif) {
                    calculateTaxCosts();
                }
                
                showNotification('Data tersimpan dimuat otomatis', 'info');
            }
        }

        // Fungsi untuk validasi input yang lebih baik
        function validateInput(inputElement, minValue = 0, maxValue = null) {
            const value = parseFloat(inputElement.value);
            const fieldName = inputElement.previousElementSibling.textContent;
            
            if (isNaN(value) || value < minValue) {
                inputElement.style.borderColor = '#dc3545';
                inputElement.style.backgroundColor = '#f8d7da';
                showNotification(`${fieldName} harus lebih dari ${minValue}`, 'warning');
                return false;
            }
            
            if (maxValue && value > maxValue) {
                inputElement.style.borderColor = '#dc3545';
                inputElement.style.backgroundColor = '#f8d7da';
                showNotification(`${fieldName} tidak boleh lebih dari ${maxValue}`, 'warning');
                return false;
            }
            
            inputElement.style.borderColor = '#28a745';
            inputElement.style.backgroundColor = '#d4edda';
            return true;
        }

        // Fungsi untuk menampilkan loading state
        function showLoading(buttonElement, text = 'Memproses...') {
            const originalText = buttonElement.innerHTML;
            buttonElement.innerHTML = `<span class="loading"></span>${text}`;
            buttonElement.disabled = true;
            
            return function hideLoading() {
                buttonElement.innerHTML = originalText;
                buttonElement.disabled = false;
            };
        }

        // Fungsi untuk keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl + 1-5 untuk pindah ke modul
                if (e.ctrlKey && e.key >= '1' && e.key <= '5') {
                    e.preventDefault();
                    const modulNumber = parseInt(e.key);
                    const modulNames = ['modul1', 'modul2', 'modul3', 'modul4', 'modul5'];
                    if (modulNames[modulNumber - 1]) {
                        showTab(modulNames[modulNumber - 1]);
                        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                        document.querySelector(`[onclick="showTab('${modulNames[modulNumber - 1]}')"]`).classList.add('active');
                    }
                }
                
                // Ctrl + R untuk reset
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    resetAllData();
                }
                
                // Ctrl + E untuk export
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportResults();
                }
                
                // F1 untuk toggle help
                if (e.key === 'F1') {
                    e.preventDefault();
                    toggleKeyboardShortcuts();
                }
                
                // Esc untuk tutup help dan modal
                if (e.key === 'Escape') {
                    document.getElementById('keyboard-shortcuts').classList.remove('show');
                    closeModal('break-even-modal');
                    closeModal('competitor-modal');
                    closeModal('dashboard-modal');
                    closeModal('template-modal');
                }
            });
        }

        // Fungsi untuk toggle keyboard shortcuts
        function toggleKeyboardShortcuts() {
            const shortcuts = document.getElementById('keyboard-shortcuts');
            shortcuts.classList.toggle('show');
        }

        // Fungsi untuk menampilkan modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Fungsi untuk menutup modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Fungsi untuk Dashboard Analytics
        function showDashboardAnalytics() {
            if (cogsTotal <= 0) {
                showNotification('Hitung COGS terlebih dahulu', 'warning');
                return;
            }

            const targetPenjualan = parseFloat(document.getElementById('target_penjualan').value) || 100;
            const targetNPM = parseFloat(document.getElementById('target_npm').value) || 15;
            const diskonTerencana = parseFloat(document.getElementById('diskon_terencana').value) || 0;
            
            // Hitung data untuk dashboard
            const totalBiayaPersentase = biayaAdminRate + biayaXTRA + komisiAfiliasiRate + pphFinalRate + targetNPM;
            const hargaJualIdeal = cogsTotal / (1 - (totalBiayaPersentase / 100));
            const hargaJualSetelahDiskon = hargaJualIdeal * (1 - diskonTerencana / 100);
            
            // Hitung biaya per unit
            const biayaAdminPerUnit = hargaJualSetelahDiskon * (biayaAdminRate / 100);
            const biayaXTRAPerUnit = Math.min(hargaJualSetelahDiskon * (biayaXTRA / 100), 10000);
            const komisiAfiliasiPerUnit = hargaJualSetelahDiskon * (komisiAfiliasiRate / 100);
            const pphFinalPerUnit = hargaJualSetelahDiskon * (pphFinalRate / 100);
            const totalBiayaPerUnit = cogsTotal + biayaAdminPerUnit + biayaXTRAPerUnit + komisiAfiliasiPerUnit + pphFinalPerUnit;
            
            const profitPerUnit = hargaJualSetelahDiskon - totalBiayaPerUnit;
            const monthlyRevenue = targetPenjualan * hargaJualSetelahDiskon;
            const monthlyProfit = targetPenjualan * profitPerUnit;
            const breakEvenUnit = Math.ceil(totalBiayaPerUnit / hargaJualSetelahDiskon);
            const marginOfSafety = ((targetPenjualan - breakEvenUnit) / targetPenjualan) * 100;
            
            // Data untuk chart
            const costBreakdown = [
                { name: 'COGS', value: cogsTotal, color: '#dc3545' },
                { name: 'Admin', value: biayaAdminPerUnit, color: '#ffc107' },
                { name: 'XTRA', value: biayaXTRAPerUnit, color: '#17a2b8' },
                { name: 'Afiliasi', value: komisiAfiliasiPerUnit, color: '#6f42c1' },
                { name: 'PPh', value: pphFinalPerUnit, color: '#fd7e14' }
            ];
            
            const maxValue = Math.max(...costBreakdown.map(item => item.value));
            
            const content = `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h4>üìä Breakdown Biaya per Unit</h4>
                        <div class="chart-container">
                            ${costBreakdown.map((item, index) => {
                                const height = (item.value / maxValue) * 150;
                                return `
                                    <div class="chart-bar" style="width: 15px; height: ${height}px; background: ${item.color};">
                                        <div class="chart-value">Rp ${(item.value/1000).toFixed(0)}K</div>
                                        <div class="chart-label">${item.name}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4>üí∞ Key Metrics</h4>
                        <div class="metric-grid">
                            <div class="metric-card">
                                <div class="metric-value">${targetPenjualan.toLocaleString('id-ID')}</div>
                                <div class="metric-label">Target Unit</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">${breakEvenUnit.toLocaleString('id-ID')}</div>
                                <div class="metric-label">Break-Even</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">${marginOfSafety.toFixed(1)}%</div>
                                <div class="metric-label">Margin Safety</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">${targetNPM}%</div>
                                <div class="metric-label">Target NPM</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4>üìà Profitability Overview</h4>
                        <div class="metric-item">
                            <span>Harga Jual Ideal:</span>
                            <span>Rp ${hargaJualIdeal.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Harga Setelah Diskon:</span>
                            <span>Rp ${hargaJualSetelahDiskon.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Total Biaya per Unit:</span>
                            <span>Rp ${totalBiayaPerUnit.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Profit per Unit:</span>
                            <span>Rp ${profitPerUnit.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Monthly Revenue:</span>
                            <span>Rp ${monthlyRevenue.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Monthly Profit:</span>
                            <span>Rp ${monthlyProfit.toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h4>üéØ Performance Indicators</h4>
                        <div class="metric-item">
                            <span>ROI per Unit:</span>
                            <span>${((profitPerUnit / totalBiayaPerUnit) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="metric-item">
                            <span>Profit Margin:</span>
                            <span>${((profitPerUnit / hargaJualSetelahDiskon) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="metric-item">
                            <span>Cost Efficiency:</span>
                            <span>${((cogsTotal / totalBiayaPerUnit) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="metric-item">
                            <span>Marketplace Fee:</span>
                            <span>${(((biayaAdminPerUnit + biayaXTRAPerUnit + komisiAfiliasiPerUnit) / hargaJualSetelahDiskon) * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h5>üí° Dashboard Insights</h5>
                    <p><strong>Status Bisnis:</strong> ${marginOfSafety > 50 ? 'üü¢ Sangat Aman' : marginOfSafety > 20 ? 'üü° Cukup Aman' : 'üî¥ Perlu Perhatian'}</p>
                    <p><strong>Rekomendasi:</strong> ${marginOfSafety > 50 ? 'Target penjualan sangat aman, pertimbangkan ekspansi.' : marginOfSafety > 20 ? 'Target penjualan cukup aman, monitor performa.' : 'Tingkatkan target penjualan atau turunkan biaya untuk mencapai break-even.'}</p>
                </div>
            `;
            
            document.getElementById('dashboard-content').innerHTML = content;
            showModal('dashboard-modal');
        }

        // Fungsi untuk Template Manager
        function showTemplateManager() {
            const templates = [
                {
                    id: 'makanan',
                    icon: 'üçï',
                    title: 'Makanan & Minuman',
                    description: 'Template untuk produk makanan dan minuman dengan biaya bahan baku tinggi',
                    tags: ['Makanan', 'B2C', 'F&B'],
                    data: {
                        bbl: 15000,
                        btkl: 5000,
                        bop: 3000,
                        biaya_admin_bulanan: 2000000,
                        target_penjualan: 1000,
                        biaya_pemasaran: 2000,
                        biaya_pengemasan: 1000,
                        target_npm: 20
                    }
                },
                {
                    id: 'fashion',
                    icon: 'üëï',
                    title: 'Fashion & Aksesoris',
                    description: 'Template untuk produk fashion dengan margin tinggi dan biaya pemasaran besar',
                    tags: ['Fashion', 'B2C', 'Retail'],
                    data: {
                        bbl: 25000,
                        btkl: 8000,
                        bop: 5000,
                        biaya_admin_bulanan: 3000000,
                        target_penjualan: 500,
                        biaya_pemasaran: 5000,
                        biaya_pengemasan: 2000,
                        target_npm: 30
                    }
                },
                {
                    id: 'elektronik',
                    icon: 'üì±',
                    title: 'Elektronik & Gadget',
                    description: 'Template untuk produk elektronik dengan biaya overhead tinggi',
                    tags: ['Elektronik', 'B2C', 'Tech'],
                    data: {
                        bbl: 100000,
                        btkl: 15000,
                        bop: 25000,
                        biaya_admin_bulanan: 5000000,
                        target_penjualan: 100,
                        biaya_pemasaran: 10000,
                        biaya_pengemasan: 5000,
                        target_npm: 15
                    }
                },
                {
                    id: 'kerajinan',
                    icon: 'üé®',
                    title: 'Kerajinan & Handmade',
                    description: 'Template untuk produk kerajinan dengan biaya tenaga kerja tinggi',
                    tags: ['Kerajinan', 'B2C', 'Handmade'],
                    data: {
                        bbl: 10000,
                        btkl: 20000,
                        bop: 5000,
                        biaya_admin_bulanan: 1500000,
                        target_penjualan: 200,
                        biaya_pemasaran: 3000,
                        biaya_pengemasan: 1500,
                        target_npm: 25
                    }
                },
                {
                    id: 'kecantikan',
                    icon: 'üíÑ',
                    title: 'Kecantikan & Kesehatan',
                    description: 'Template untuk produk kecantikan dengan regulasi ketat',
                    tags: ['Kecantikan', 'B2C', 'Health'],
                    data: {
                        bbl: 20000,
                        btkl: 10000,
                        bop: 8000,
                        biaya_admin_bulanan: 2500000,
                        target_penjualan: 300,
                        biaya_pemasaran: 4000,
                        biaya_pengemasan: 2500,
                        target_npm: 35
                    }
                },
                {
                    id: 'rumah-tangga',
                    icon: 'üè†',
                    title: 'Rumah Tangga & Dapur',
                    description: 'Template untuk produk rumah tangga dengan volume tinggi',
                    tags: ['Rumah Tangga', 'B2C', 'Home'],
                    data: {
                        bbl: 30000,
                        btkl: 12000,
                        bop: 8000,
                        biaya_admin_bulanan: 4000000,
                        target_penjualan: 800,
                        biaya_pemasaran: 2500,
                        biaya_pengemasan: 2000,
                        target_npm: 18
                    }
                }
            ];
            
            const content = `
                <div class="template-grid">
                    ${templates.map(template => `
                        <div class="template-card" onclick="selectTemplate('${template.id}')">
                            <div class="template-icon">${template.icon}</div>
                            <div class="template-title">${template.title}</div>
                            <div class="template-description">${template.description}</div>
                            <div class="template-tags">
                                ${template.tags.map(tag => `<span class="template-tag">${tag}</span>`).join('')}
                            </div>
                            <div class="template-actions">
                                <button class="btn-template btn-preview" onclick="event.stopPropagation(); previewTemplate('${template.id}')">Preview</button>
                                <button class="btn-template btn-apply" onclick="event.stopPropagation(); applyTemplate('${template.id}')">Apply</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div id="template-preview" class="template-preview" style="display: none;">
                    <div class="preview-title">Preview Template</div>
                    <div id="preview-content"></div>
                </div>
            `;
            
            document.getElementById('template-content').innerHTML = content;
            showModal('template-modal');
        }

        // Fungsi untuk memilih template
        function selectTemplate(templateId) {
            // Remove selected class from all cards
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            event.currentTarget.classList.add('selected');
        }

        // Fungsi untuk preview template
        function previewTemplate(templateId) {
            const templates = {
                'makanan': {
                    icon: 'üçï',
                    title: 'Makanan & Minuman',
                    data: {
                        bbl: 15000,
                        btkl: 5000,
                        bop: 3000,
                        biaya_admin_bulanan: 2000000,
                        target_penjualan: 1000,
                        biaya_pemasaran: 2000,
                        biaya_pengemasan: 1000,
                        target_npm: 20
                    }
                },
                'fashion': {
                    icon: 'üëï',
                    title: 'Fashion & Aksesoris',
                    data: {
                        bbl: 25000,
                        btkl: 8000,
                        bop: 5000,
                        biaya_admin_bulanan: 3000000,
                        target_penjualan: 500,
                        biaya_pemasaran: 5000,
                        biaya_pengemasan: 2000,
                        target_npm: 30
                    }
                },
                'elektronik': {
                    icon: 'üì±',
                    title: 'Elektronik & Gadget',
                    data: {
                        bbl: 100000,
                        btkl: 15000,
                        bop: 25000,
                        biaya_admin_bulanan: 5000000,
                        target_penjualan: 100,
                        biaya_pemasaran: 10000,
                        biaya_pengemasan: 5000,
                        target_npm: 15
                    }
                },
                'kerajinan': {
                    icon: 'üé®',
                    title: 'Kerajinan & Handmade',
                    data: {
                        bbl: 10000,
                        btkl: 20000,
                        bop: 5000,
                        biaya_admin_bulanan: 1500000,
                        target_penjualan: 200,
                        biaya_pemasaran: 3000,
                        biaya_pengemasan: 1500,
                        target_npm: 25
                    }
                },
                'kecantikan': {
                    icon: 'üíÑ',
                    title: 'Kecantikan & Kesehatan',
                    data: {
                        bbl: 20000,
                        btkl: 10000,
                        bop: 8000,
                        biaya_admin_bulanan: 2500000,
                        target_penjualan: 300,
                        biaya_pemasaran: 4000,
                        biaya_pengemasan: 2500,
                        target_npm: 35
                    }
                },
                'rumah-tangga': {
                    icon: 'üè†',
                    title: 'Rumah Tangga & Dapur',
                    data: {
                        bbl: 30000,
                        btkl: 12000,
                        bop: 8000,
                        biaya_admin_bulanan: 4000000,
                        target_penjualan: 800,
                        biaya_pemasaran: 2500,
                        biaya_pengemasan: 2000,
                        target_npm: 18
                    }
                }
            };
            
            const template = templates[templateId];
            const previewContent = `
                <div class="preview-item">
                    <span>BBL per Unit:</span>
                    <span>Rp ${template.data.bbl.toLocaleString('id-ID')}</span>
                </div>
                <div class="preview-item">
                    <span>BTKL per Unit:</span>
                    <span>Rp ${template.data.btkl.toLocaleString('id-ID')}</span>
                </div>
                <div class="preview-item">
                    <span>BOP per Unit:</span>
                    <span>Rp ${template.data.bop.toLocaleString('id-ID')}</span>
                </div>
                <div class="preview-item">
                    <span>Biaya Admin Bulanan:</span>
                    <span>Rp ${template.data.biaya_admin_bulanan.toLocaleString('id-ID')}</span>
                </div>
                <div class="preview-item">
                    <span>Target Penjualan:</span>
                    <span>${template.data.target_penjualan.toLocaleString('id-ID')} unit</span>
                </div>
                <div class="preview-item">
                    <span>Target NPM:</span>
                    <span>${template.data.target_npm}%</span>
                </div>
            `;
            
            document.getElementById('preview-content').innerHTML = previewContent;
            document.getElementById('template-preview').style.display = 'block';
        }

        // Fungsi untuk menerapkan template
        function applyTemplate(templateId) {
            const templates = {
                'makanan': {
                    bbl: 15000,
                    btkl: 5000,
                    bop: 3000,
                    biaya_admin_bulanan: 2000000,
                    target_penjualan: 1000,
                    biaya_pemasaran: 2000,
                    biaya_pengemasan: 1000,
                    target_npm: 20
                },
                'fashion': {
                    bbl: 25000,
                    btkl: 8000,
                    bop: 5000,
                    biaya_admin_bulanan: 3000000,
                    target_penjualan: 500,
                    biaya_pemasaran: 5000,
                    biaya_pengemasan: 2000,
                    target_npm: 30
                },
                'elektronik': {
                    bbl: 100000,
                    btkl: 15000,
                    bop: 25000,
                    biaya_admin_bulanan: 5000000,
                    target_penjualan: 100,
                    biaya_pemasaran: 10000,
                    biaya_pengemasan: 5000,
                    target_npm: 15
                },
                'kerajinan': {
                    bbl: 10000,
                    btkl: 20000,
                    bop: 5000,
                    biaya_admin_bulanan: 1500000,
                    target_penjualan: 200,
                    biaya_pemasaran: 3000,
                    biaya_pengemasan: 1500,
                    target_npm: 25
                },
                'kecantikan': {
                    bbl: 20000,
                    btkl: 10000,
                    bop: 8000,
                    biaya_admin_bulanan: 2500000,
                    target_penjualan: 300,
                    biaya_pemasaran: 4000,
                    biaya_pengemasan: 2500,
                    target_npm: 35
                },
                'rumah-tangga': {
                    bbl: 30000,
                    btkl: 12000,
                    bop: 8000,
                    biaya_admin_bulanan: 4000000,
                    target_penjualan: 800,
                    biaya_pemasaran: 2500,
                    biaya_pengemasan: 2000,
                    target_npm: 18
                }
            };
            
            const template = templates[templateId];
            
            // Apply template data to form fields
            document.getElementById('bbl').value = template.bbl;
            document.getElementById('btkl').value = template.btkl;
            document.getElementById('bop').value = template.bop;
            document.getElementById('biaya_admin_bulanan').value = template.biaya_admin_bulanan;
            document.getElementById('target_penjualan').value = template.target_penjualan;
            document.getElementById('biaya_pemasaran').value = template.biaya_pemasaran;
            document.getElementById('biaya_pengemasan').value = template.biaya_pengemasan;
            document.getElementById('target_npm').value = template.target_npm;
            
            // Trigger calculations
            calculateHPP();
            calculateCOGS();
            
            // Close modal
            closeModal('template-modal');
            
            // Show notification
            showNotification(`Template ${templateId} berhasil diterapkan!`, 'success');
        }

        // Fungsi untuk analisis break-even point
        function showBreakEvenAnalysis() {
            if (cogsTotal <= 0) {
                showNotification('Hitung COGS terlebih dahulu', 'warning');
                return;
            }

            const targetPenjualan = parseFloat(document.getElementById('target_penjualan').value) || 100;
            const targetNPM = parseFloat(document.getElementById('target_npm').value) || 15;
            const diskonTerencana = parseFloat(document.getElementById('diskon_terencana').value) || 0;
            
            // Hitung harga jual ideal
            const totalBiayaPersentase = biayaAdminRate + biayaXTRA + komisiAfiliasiRate + pphFinalRate + targetNPM;
            const hargaJualIdeal = cogsTotal / (1 - (totalBiayaPersentase / 100));
            const hargaJualSetelahDiskon = hargaJualIdeal * (1 - diskonTerencana / 100);
            
            // Hitung biaya marketplace per unit terlebih dahulu
            const biayaAdminPerUnit = hargaJualSetelahDiskon * (biayaAdminRate / 100);
            const biayaXTRAPerUnit = Math.min(hargaJualSetelahDiskon * (biayaXTRA / 100), 10000);
            const komisiAfiliasiPerUnit = hargaJualSetelahDiskon * (komisiAfiliasiRate / 100);
            const pphFinalPerUnit = hargaJualSetelahDiskon * (pphFinalRate / 100);
            
            // Hitung total biaya per unit (COGS + biaya marketplace + pajak)
            const totalBiayaPerUnit = cogsTotal + biayaAdminPerUnit + biayaXTRAPerUnit + komisiAfiliasiPerUnit + pphFinalPerUnit;
            
            // Hitung break-even point berdasarkan total biaya per unit
            const breakEvenUnit = Math.ceil(totalBiayaPerUnit / hargaJualSetelahDiskon);
            const breakEvenRevenue = breakEvenUnit * hargaJualSetelahDiskon;
            
            // Hitung margin of safety
            const marginOfSafety = ((targetPenjualan - breakEvenUnit) / targetPenjualan) * 100;
            
            // Hitung monthly profit yang akurat
            const monthlyRevenue = targetPenjualan * hargaJualSetelahDiskon;
            
            // Hitung profit per unit yang akurat
            const profitPerUnit = hargaJualSetelahDiskon - totalBiayaPerUnit;
            const monthlyProfit = targetPenjualan * profitPerUnit;
            
            const paybackPeriod = monthlyProfit > 0 ? 'Tidak ada (profit positif)' : 'Tidak dapat dihitung (rugi)';
            
            const content = `
                <div class="analysis-grid">
                <div class="analysis-card">
                    <h4>üìä Break-Even Analysis</h4>
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                        <strong>Break-Even Point</strong> adalah jumlah unit yang harus dijual untuk menutupi semua biaya (tidak untung, tidak rugi).
                    </p>
                    <div class="metric-item">
                        <span>Break-Even Unit:</span>
                        <span>${breakEvenUnit.toLocaleString('id-ID')} unit</span>
                    </div>
                    <div class="metric-item">
                        <span>Break-Even Revenue:</span>
                        <span>Rp ${breakEvenRevenue.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item">
                        <span>Target Penjualan:</span>
                        <span>${targetPenjualan.toLocaleString('id-ID')} unit</span>
                    </div>
                    <div class="metric-item">
                        <span>Margin of Safety:</span>
                        <span>${marginOfSafety.toFixed(1)}%</span>
                    </div>
                </div>
                    
                    <div class="analysis-card">
                        <h4>üí∞ Profitability Analysis</h4>
                        <div class="metric-item">
                            <span>Harga Jual Ideal:</span>
                            <span>Rp ${hargaJualIdeal.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Harga Setelah Diskon:</span>
                            <span>Rp ${hargaJualSetelahDiskon.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Profit per Unit:</span>
                            <span>Rp ${profitPerUnit.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Monthly Profit:</span>
                            <span>Rp ${(monthlyProfit).toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                </div>
                
                ${marginOfSafety < 20 ? `
                    <div class="warning">
                        <h5>‚ö†Ô∏è Peringatan</h5>
                        <p>Margin of Safety Anda rendah (${marginOfSafety.toFixed(1)}%). Pertimbangkan untuk meningkatkan target penjualan atau menurunkan biaya produksi.</p>
                    </div>
                ` : ''}
                
                <div class="analysis-card" style="grid-column: 1 / -1; margin-top: 20px;">
                    <h4>üìã Breakdown Biaya per Unit</h4>
                    <div class="metric-item">
                        <span>COGS Total:</span>
                        <span>Rp ${cogsTotal.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item">
                        <span>Biaya Admin (${biayaAdminRate}%):</span>
                        <span>Rp ${biayaAdminPerUnit.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item">
                        <span>Biaya XTRA (${biayaXTRA}%):</span>
                        <span>Rp ${biayaXTRAPerUnit.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item">
                        <span>Komisi Afiliasi (${komisiAfiliasiRate.toFixed(2)}%):</span>
                        <span>Rp ${komisiAfiliasiPerUnit.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item">
                        <span>PPh Final (${pphFinalRate}%):</span>
                        <span>Rp ${pphFinalPerUnit.toLocaleString('id-ID')}</span>
                    </div>
                    <div class="metric-item" style="border-top: 2px solid #007bff; font-weight: bold;">
                        <span>Total Biaya per Unit:</span>
                        <span>Rp ${totalBiayaPerUnit.toLocaleString('id-ID')}</span>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h5>üí° Rekomendasi Break-Even</h5>
                    <p><strong>Break-Even Point:</strong> Anda perlu menjual minimal <strong>${breakEvenUnit.toLocaleString('id-ID')} unit</strong> per bulan untuk menutupi semua biaya (COGS + marketplace + pajak).</p>
                    <p><strong>Target Penjualan:</strong> ${targetPenjualan.toLocaleString('id-ID')} unit/bulan</p>
                    <p><strong>Status:</strong> ${marginOfSafety > 0 ? 
                        `‚úÖ AMAN - Margin of Safety ${marginOfSafety.toFixed(1)}% (${(targetPenjualan - breakEvenUnit).toLocaleString('id-ID')} unit di atas break-even)` : 
                        `‚ö†Ô∏è BERISIKO - Target penjualan di bawah break-even point`}</p>
                    ${marginOfSafety <= 0 ? '<p><strong>üí° Saran:</strong> Tingkatkan target penjualan atau turunkan biaya produksi untuk mencapai break-even.</p>' : ''}
                </div>
            `;
            
            document.getElementById('break-even-content').innerHTML = content;
            showModal('break-even-modal');
        }

        // Fungsi untuk analisis kompetitor
        function showCompetitorAnalysis() {
            const hargaKompetitor = parseFloat(document.getElementById('harga_kompetitor').value) || 0;
            const targetNPM = parseFloat(document.getElementById('target_npm').value) || 15;
            
            if (hargaKompetitor <= 0) {
                showNotification('Masukkan harga kompetitor terlebih dahulu', 'warning');
                return;
            }

            // Hitung harga jual ideal
            const totalBiayaPersentase = biayaAdminRate + biayaXTRA + komisiAfiliasiRate + pphFinalRate + targetNPM;
            const hargaJualIdeal = cogsTotal / (1 - (totalBiayaPersentase / 100));
            
            const selisihHarga = hargaJualIdeal - hargaKompetitor;
            const persentaseSelisih = (selisihHarga / hargaKompetitor) * 100;
            
            // Analisis posisi kompetitif
            let posisiKompetitif = '';
            let strategiHarga = '';
            let rekomendasi = '';
            
            if (persentaseSelisih > 20) {
                posisiKompetitif = 'Tidak Kompetitif';
                strategiHarga = 'Harga terlalu tinggi';
                rekomendasi = 'Fokus pada efisiensi biaya atau diferensiasi produk';
            } else if (persentaseSelisih > 5) {
                posisiKompetitif = 'Kurang Kompetitif';
                strategiHarga = 'Harga agak tinggi';
                rekomendasi = 'Pertimbangkan penurunan margin atau peningkatan nilai';
            } else if (persentaseSelisih >= -5) {
                posisiKompetitif = 'Kompetitif';
                strategiHarga = 'Harga seimbang';
                rekomendasi = 'Posisi harga yang baik, fokus pada kualitas dan layanan';
            } else if (persentaseSelisih >= -20) {
                posisiKompetitif = 'Sangat Kompetitif';
                strategiHarga = 'Harga lebih rendah';
                rekomendasi = 'Pertimbangkan peningkatan harga untuk margin yang lebih baik';
            } else {
                posisiKompetitif = 'Terlalu Murah';
                strategiHarga = 'Harga terlalu rendah';
                rekomendasi = 'Segera tingkatkan harga untuk menghindari race to the bottom';
            }
            
            const content = `
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>üèÜ Posisi Kompetitif</h4>
                        <div class="metric-item">
                            <span>Harga Ideal Anda:</span>
                            <span>Rp ${hargaJualIdeal.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Harga Kompetitor:</span>
                            <span>Rp ${hargaKompetitor.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Selisih Harga:</span>
                            <span>Rp ${selisihHarga.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Persentase Selisih:</span>
                            <span>${persentaseSelisih.toFixed(1)}%</span>
                        </div>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>üìà Analisis Posisi</h4>
                        <div class="metric-item">
                            <span>Posisi Kompetitif:</span>
                            <span>${posisiKompetitif}</span>
                        </div>
                        <div class="metric-item">
                            <span>Strategi Harga:</span>
                            <span>${strategiHarga}</span>
                        </div>
                        <div class="metric-item">
                            <span>COGS per Unit:</span>
                            <span>Rp ${cogsTotal.toLocaleString('id-ID')}</span>
                        </div>
                        <div class="metric-item">
                            <span>Margin Kompetitor:</span>
                            <span>${((hargaKompetitor - cogsTotal) / hargaKompetitor * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
                
                <div class="recommendation">
                    <h5>üí° Rekomendasi Strategi</h5>
                    <p><strong>${rekomendasi}</strong></p>
                    <ul>
                        ${persentaseSelisih > 10 ? `
                            <li>Tinjau kembali biaya produksi dan cari supplier yang lebih murah</li>
                            <li>Pertimbangkan automasi untuk mengurangi biaya tenaga kerja</li>
                            <li>Fokus pada diferensiasi produk untuk membenarkan harga premium</li>
                        ` : ''}
                        ${persentaseSelisih < -10 ? `
                            <li>Pertimbangkan peningkatan harga secara bertahap</li>
                            <li>Tambahkan fitur atau layanan yang meningkatkan nilai produk</li>
                            <li>Fokus pada kualitas untuk membenarkan harga yang lebih tinggi</li>
                        ` : ''}
                        <li>Monitor harga kompetitor secara berkala</li>
                        <li>Lakukan A/B testing untuk harga yang optimal</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('competitor-content').innerHTML = content;
            showModal('competitor-modal');
        }

        // Auto-calculate saat input berubah
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            loadDataFromLocalStorage();
            
            // Setup keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Auto-calculate HPP saat input berubah
            ['bbl', 'btkl', 'bop'].forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', function() {
                    validateInput(this, 0);
                    calculateHPP();
                    saveDataToLocalStorage();
                });
            });
            
            // Auto-calculate COGS saat input berubah
            ['biaya_admin', 'target_penjualan', 'biaya_pemasaran', 'biaya_pengemasan'].forEach(id => {
                const element = document.getElementById(id);
                element.addEventListener('input', function() {
                    validateInput(this, 0);
                    calculateCOGS();
                    saveDataToLocalStorage();
                });
            });
            
            // Auto-save for other inputs
            ['marketplace', 'kategori_produk', 'komisi_afiliasi', 'persentase_afiliasi', 'omzet_kumulatif', 'target_npm', 'diskon_terencana', 'harga_kompetitor'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveDataToLocalStorage);
                }
            });
            
            // Auto-save for checkboxes
            ['gratis_ongkir', 'cashback_xtra'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveDataToLocalStorage);
                }
            });
        });
    </script>
</body>
</html>
